suppressMessages(library(tidyr))
suppressMessages(library(dplyr))
suppressMessages(library(data.table))
suppressMessages(library(ggplot2))
nuclide<-"226Ra"
cat("current nuclide: ", nuclide, "\n")
data<-read.csv("SummingCorrectionFactor.csv",row.names = NULL)
View(data)
data<-filter(data,Nuclide==nuclide)
simData<-read.csv("factors.csv", row.names = NULL)
View(simData)
simData<-simData[,1:length(simData)-1]
names(simData)[1] <- "Energy"
simData<-pivot_longer(simData,cols= c("A0","A1","A2","A3","B0","B1","B2","B3"),names_to=
"Detector", values_to = "sim_z")
require(data.table)
setDT(simData)
setDT(data)
simData<-arrange(simData, Energy, Detector)
data<-arrange(data,Energy,Detector)
simData$Energy<-data$Energy
cor_full<-merge(data,simData,by=c("Energy","Detector"))
View(cor_full)
cor_full<-arrange(cor_full, Energy, Detector)
simData<-read.csv("factors.csv", row.names = NULL)
re<-gather(simData, det, value, A0:B3)
View(re)
simData<-read.csv("factors.csv", row.names = NULL)%>%gather( det, value, A0:B3)
expData<-read.csv("./correction_factor_measured.csv", stringsAsFactors = FALSE)
View(expData)
View(data)
View(simData)
View(expData)
View(data)
View(data)
nuclide<-"226Ra"
cat("current nuclide: ", nuclide, "\n")
data<-read.csv("SummingCorrectionFactor.csv",row.names = NULL)
data<-filter(data,Nuclide==nuclide)
simData<-read.csv("factors.csv", row.names = NULL)
simData<-simData[,1:length(simData)-1]
names(simData)[1] <- "Energy"
View(simData)
simData<-read.csv("factors.csv", row.names = NULL)%>%gather( det, value, A0:B3)
names(simData)[1] <- "Energy"
View(simData)
names(simData) <- c("Energy", "Detector", "sim_z")
require(data.table)
setDT(simData)
setDT(data)
simData<-arrange(simData, Energy, Detector)
data<-arrange(data,Energy,Detector)
simData$Energy<-data$Energy
NULL
simData<-read.csv("factors.csv", row.names = NULL)%>%gather( det, value, A0:B3)
expData<-read.csv("./correction_factor_measured.csv", stringsAsFactors = FALSE)
expData$energy[NULL]
data<-expData%>%rowwise()%>%mutate(simIndex = GetEnergy_det(energy, det))
GetEnergy_det <- function(e, det){
.index<- which(e - 1 < eff_sum$energy &
e + 1 > eff_sum$energy &
det == eff_sum$det
)
if(length(.index) != 1){
print("index length not equal to 1! ")
print(e)
print(det)
return(NA)
}
return(.index)
}
data<-expData%>%rowwise()%>%mutate(simIndex = GetEnergy_det(energy, det))
simData<-read.csv("factors.csv", row.names = NULL)%>%gather( det, value, A0:B3)
data<-expData%>%rowwise()%>%mutate(simIndex = which(value - 1 < simData$energy.keV. &
value + 1 > simData$energy.keV. &
det == simData$det)
)
data<-expData%>%rowwise()%>%mutate(IndexLength = which(value - 1 < simData$energy.keV. &
value + 1 > simData$energy.keV. &
det == simData$det)
)
data<-expData%>%rowwise()%>%mutate(IndexLength = length(which(value - 1 < simData$energy.keV. &
value + 1 > simData$energy.keV. &
det == simData$det))
)
View(data)
data<-expData%>%rowwise()%>%mutate(IndexLength = length(which(energy - 1 < simData$energy.keV. &
energy + 1 > simData$energy.keV. &
det == simData$det))
)
data<-expData%>%rowwise()%>%mutate(IndexLength = length(which(energy - 1 < simData$energy.keV. &
energy + 1 > simData$energy.keV. &
det == simData$det))
)%>%filter(IndexLength == 1)
data<-expData%>%rowwise()%>%mutate(simIndex = toNA(which(energy - 1 < simData$energy.keV. &
energy + 1 > simData$energy.keV. &
det == simData$det))
)%>%na.omit()
toNA = function(i){
if(length(i) == 0){
return(NA)
} else{
return(i[1])
}
}
data<-expData%>%rowwise()%>%mutate(simIndex = toNA(which(energy - 1 < simData$energy.keV. &
energy + 1 > simData$energy.keV. &
det == simData$det))
)%>%na.omit()
data<-expData%>%rowwise()%>%mutate(simIndex = toNA(which(energy - 1 < simData$energy.keV. &
energy + 1 > simData$energy.keV. &
det == simData$det))
)%>%
na.omit()%>%mutate(simValue = simData$value[simIndex])
data<-expData%>%rowwise()%>%mutate(simIndex = toNA(which(energy - 1 < simData$energy.keV. &
energy + 1 > simData$energy.keV. &
det == simData$det))
)%>%
na.omit()%>%mutate(simValue = simData$value[simIndex])%>%select(-simIndex)
gplot<-data%>%ggplot(aes(x=energy))+
geom_point(aes(y=value, color="Measurement"),size=1)+
geom_errorbar(mapping=aes(ymin=value-err, ymax=value+err), width=15, size=0.3,color="red")+
geom_line(aes(y=simValue,color="Simulation"))+
facet_grid(rows=vars(det))+
scale_color_manual(values = c("red","black"),labels=c("Measurement","Simulation"))+
labs(title=nuclide, x="Energy (keV)", y="summing correction factor")+
theme(legend.title=element_blank(),legend.justification = "left", legend.position = "top")+
guides(colour=guide_legend(override.aes=list(
linetype=c (0, 1),shape=c(16,NA))))
gplot
View(expData)
suppressMessages(library(tidyr))
suppressMessages(library(dplyr))
suppressMessages(library(ggplot2))
simData<-read.csv("factors.csv", row.names = NULL)%>%gather( det, value, A0:B3)
expData<-read.csv("./correction_factor_measured.csv", stringsAsFactors = FALSE)
names(expData)<-c("energy", "det", "value", "err")
toNA = function(i){
if(length(i) == 0){
return(NA)
} else{
return(i[1])
}
}
data<-expData%>%rowwise()%>%mutate(simIndex = toNA(which(energy - 1 < simData$energy.keV. &
energy + 1 > simData$energy.keV. &
det == simData$det))
)%>%
na.omit()%>%mutate(simValue = simData$value[simIndex])%>%select(-simIndex)
gplot<-data%>%ggplot(aes(x=energy))+
geom_point(aes(y=value, color="Measurement"),size=1)+
geom_errorbar(mapping=aes(ymin=value-err, ymax=value+err), width=15, size=0.3,color="red")+
geom_line(aes(y=simValue,color="Simulation"))+
facet_grid(rows=vars(det))+
scale_color_manual(values = c("red","black"),labels=c("Measurement","Simulation"))+
labs(title=nuclide, x="Energy (keV)", y="summing correction factor")+
theme(legend.title=element_blank(),legend.justification = "left", legend.position = "top")+
guides(colour=guide_legend(override.aes=list(
linetype=c (0, 1),shape=c(16,NA))))
gplot
expDataFile <- "DataRa.csv"
expDataFile%>%strsplit(split = "\\.")
expDataFile%>%strsplit(split = "\\.")%>%unlist()%>%nth(1)
test<-read.csv("Summing_Sim_Ex_Comp_152Eu.csv")
View(test)
test<-read.csv("Summing_Sim_Ex_Comp_152Eu.csv")%>%na.omit()
test2<-data.frame(energy = test$Energy, det = test$Detector, value = z, err = dz)
test2<-data.frame(energy = test$Energy, det = test$Detector, value = test$z, err = test$dz)
View(test2)
write.csv(factors_exp, "./other_152Eu.csv", row.names = FALSE)
write.csv(test2, "./other_152Eu.csv", row.names = FALSE)
test<-read.csv("Summing_Sim_Ex_Comp_226Ra.csv.csv")%>%na.omit()
test2<-data.frame(energy = test$Energy, det = test$Detector, value = test$z, err = test$dz)
test<-read.csv("Summing_Sim_Ex_Comp_226Ra.csv")%>%na.omit()
test2<-data.frame(energy = test$Energy, det = test$Detector, value = test$z, err = test$dz)
write.csv(test2, "./other_226Ra.csv", row.names = FALSE)
